
{% extends "base.html" %}
{% block styles %}
<script src="{{ url_for('static', filename='bower_components/react/react.js') }}"></script>
<script src="{{ url_for('static', filename='bower_components/react/react-dom.js') }}"></script>
<script src="{{ url_for('static', filename='js/reactable.js') }}"></script>

<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/model.css') }}">
{% endblock %}
{% block content %}

<div id="root"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.1.0/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.1.0/react-dom.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/JSXTransformer.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script type="text/jsx">
/** @jsx React.DOM */
var App = React.createClass({

  getInitialState: function() {
    return {
      agencies: [],
      launches: [],
      locations: [],
      missions: []
    }
  },

  componentDidMount: function() {
    var _this = this;
   

    var request = "/api/search?term="+getParameterByName("term");

    console.log(request);
    this.serverRequest =
      axios
        .get(request)
        .then(function(result) {
          
          const agencies = result.data.search_results.agencies;
    
          const launches = result.data.search_results.launches;

          const locations = result.data.search_results.locations;

          const missions = result.data.search_results.missions;

          _this.setState({launches: launches});
          _this.setState({locations: locations});
          _this.setState({missions: missions});
          _this.setState({agencies: agencies});
        })

  },

  componentWillUnmount: function() {
    this.serverRequest.abort();
  },

  render: function() {
    var agencies = this.state.agencies;
    var launches = this.state.launches;
    var locations = this.state.locations;
    var missions = this.state.missions;
    var name = "name";
    var highlight_list = "highlight_list";
    var Table = Reactable.Table,
      Thead = Reactable.Thead,
      Th = Reactable.Th,
      Tr = Reactable.Tr,
      Td = Reactable.Td;
      unsafe = Reactable.unsafe;

    return <div className="col-md-10 col-md-offset-1">
          <h1> Search Results </h1>
          <Table className="table" id="table" itemsPerPage={10} pageButtonLimit={5}>
          <Thead>
            <Th column="name">
              <strong className="name-header">Agency</strong>
            </Th>
            <Th column="age">
              <strong className="age-header">Context</strong>
            </Th>
          </Thead>
          {agencies.map(function(obj) {
            return <Tr>
                <Td column="name" >
                   <a href={"/agencies?id=" + obj["id"]}>{obj[name]}</a>
                </Td>
                <Td column="age">{unsafe(obj[highlight_list][0])}</Td>
            </Tr>
          })}
      </Table>
      <Table className="table" id="table" itemsPerPage={10} pageButtonLimit={5}>
          <Thead>
            <Th column="name">
              <strong className="name-header">Launch</strong>
            </Th>
            <Th column="age">
              <strong className="age-header">Context</strong>
            </Th>
          </Thead>
          {launches.map(function(obj) {
            return <Tr>
                <Td column="name">
                   <a href={"/launches?id=" + obj["id"]}>{obj[name]}</a>
                </Td>
                <Td column="age">{unsafe(obj[highlight_list][0])}</Td>
            </Tr>
          })}
      </Table>
      <Table className="table" id="table" itemsPerPage={10} pageButtonLimit={5}>
          <Thead>
            <Th column="name">
              <strong className="name-header">Location</strong>
            </Th>
            <Th column="age">
              <strong className="age-header">Context</strong>
            </Th>
          </Thead>
          {locations.map(function(obj) {
            return <Tr>
                <Td column="name">
                   <a href={"/locations?id=" + obj["id"]}>{obj[name]}</a>
                </Td>
                <Td column="age">{unsafe(obj[highlight_list][0])}</Td>
            </Tr>
          })}
      </Table>
      <Table className="table" id="table" itemsPerPage={10} pageButtonLimit={5}>
          <Thead>
            <Th column="name">
              <strong className="name-header">Mission</strong>
            </Th>
            <Th column="age">
              <strong className="age-header">Context</strong>
            </Th>
          </Thead>
          {missions.map(function(obj) {
            return <Tr>
                <Td column="name">
                   <a href={"/missions?id=" + obj["id"]}>{obj[name]}</a>
                </Td>
                <Td column="age">{unsafe(obj[highlight_list][0])}</Td>
            </Tr>
          })}
      </Table>
    </div>
  }
});
function drawInstance(){
  console.log('want to draw')
  ReactDOM.render(
    React.createElement(App, {items: 0}),
    document.getElementById('root')
  );
}
drawInstance();

</script>
<script>
function getParameterByName(name, url) {
    if (!url) {
      url = window.location.href;
    }
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
}
</script>
<!-- Above lines of code says that this html file will take all the HTML from base.html. -->
<!-- In base.html, I've written where the content will be put in for the html files that extend base.html. Look at index.html for an example-->

<!-- Put any html that this page will display between block content and end block -->


{% endblock %}